# CLMS - Comprehensive Library Management System
## Product Requirements Document (PRD)

**Version:** 2.0
**Date:** January 2025
**Status:** 85% Complete - Phase 1 Enhancement Focus
**Project Type:** Educational Library Management Platform

---

## 1. EXECUTIVE SUMMARY

CLMS (Computerized Library Management System) is a production-ready, enterprise-grade student tracking and equipment management solution designed for modern educational institutions. The system provides seamless barcode scanning, real-time equipment tracking, and comprehensive analytics across multiple devices including PCs and iPads.

**Current State:**
- 85% complete with solid architecture
- 26 API endpoints fully functional
- 13 working frontend tabs with modern UI
- 11 core database tables with proper relationships
- 50+ completed features
- Authentication system fixed and operational
- Docker-based deployment ready

**Strategic Focus:**
Complete the remaining 15% to achieve production excellence through:
1. Settings page implementation (6 configuration tabs)
2. Mobile responsive design optimization
3. Performance enhancements with caching strategies
4. FERPA compliance validation and security hardening
5. Comprehensive testing across all features

---

## 2. TECHNOLOGY STACK & ARCHITECTURE

### 2.1 Backend Technologies
- **Runtime:** Node.js 20 LTS
- **Framework:** Express.js with TypeScript
- **ORM:** Prisma (MySQL 8.0)
- **Caching & Queues:** Redis 7, Bull Queues
- **Real-Time:** WebSocket (custom implementation)
- **Authentication:** JWT with bcrypt (12 rounds)

### 2.2 Frontend Technologies
- **Framework:** React 18 with TypeScript
- **Build Tool:** Vite 5
- **UI Framework:** shadcn/ui + Tailwind CSS 3
- **State Management:** TanStack Query + Zustand
- **Theme System:** next-themes (light/dark/system)
- **Animation:** Framer Motion

### 2.3 Infrastructure
- **Containerization:** Docker + Docker Compose
- **Database:** MySQL 8.0 (port 3308)
- **Caching:** Redis (port 6380)
- **CI/CD:** GitHub Actions (planned)
- **Deployment:** Local network with centralized server

### 2.4 Development Best Practices (from Research)

**React 18 Performance Optimization:**
- Use React.memo() for expensive components
- Implement useCallback/useMemo for computed values
- Lazy loading with React.lazy() and Suspense
- Code splitting for reduced bundle size
- Performance API integration for monitoring

**Prisma Best Practices:**
- Connection pooling with proper configuration
- Type-safe queries with generated client
- Error handling with PrismaClientKnownRequestError
- Health checks with $metrics API
- Proper disconnect handling in async operations

**Docker Production Patterns:**
- Multi-stage builds for optimized images
- Health checks for service dependencies
- Volume management for persistent data
- Network isolation for security
- Restart policies for reliability

---

## 3. SECURITY & COMPLIANCE REQUIREMENTS

### 3.1 FERPA Compliance (from Research)

**Critical Requirements:**
1. **Access Controls:** Implement granular permissions for student record access
2. **Audit Logging:** Comprehensive tracking of all data access and modifications
3. **Data Encryption:** 
   - At-rest: AES-256 for sensitive fields
   - In-transit: TLS 1.3 for all communications
4. **Consent Management:** Written consent tracking for data disclosures
5. **Annual Notifications:** System notifications for FERPA rights
6. **Secure Storage:** Encrypted backups with controlled access
7. **Amendment Procedures:** Student record correction workflows

### 3.2 JWT Security Best Practices (from Research)

**Implementation Standards:**
1. **Strong Algorithms:** Use RS256 or HS256 with 256-bit keys
2. **Token Expiration:** Short-lived access tokens (15-30 min) with refresh tokens
3. **Secure Storage:** HttpOnly, Secure, SameSite cookies
4. **Signature Verification:** Always validate token integrity
5. **Claims Validation:** Verify exp, iss, aud claims
6. **Token Rotation:** Refresh token rotation on use
7. **Revocation System:** Token blacklist for immediate logout

### 3.3 Role-Based Access Control (RBAC)

**User Roles:**
1. SUPERADMIN - Full system access
2. ADMIN - Administrative functions
3. LIBRARIAN - Daily operations
4. TEACHER - Classroom integration
5. STUDENT - Self-service (planned)
6. GUEST - Read-only public access

**Permission Categories:**
- read:students, write:students, delete:students
- read:books, write:books, delete:books
- read:equipment, write:equipment, manage:equipment
- read:analytics, generate:reports
- system:configure, system:backup

---

## 4. PROGRESSIVE WEB APP (PWA) REQUIREMENTS

### 4.1 Offline-First Architecture (from Research)

**Service Worker Implementation:**
1. **Caching Strategies:**
   - Network-first for API calls with fallback
   - Cache-first for static assets
   - Stale-while-revalidate for images
2. **Background Sync:** Queue failed requests for retry
3. **Offline Notifications:** User feedback for connectivity status
4. **Data Persistence:** IndexedDB for offline data storage

**PWA Features:**
- Installable on iOS/Android via "Add to Home Screen"
- Offline functionality for essential operations
- Push notifications for system alerts
- App manifest with icons and theme colors
- Service worker lifecycle management

### 4.2 Mobile Responsive Design

**Breakpoints:**
- Mobile: 320px - 767px
- Tablet: 768px - 1023px
- Desktop: 1024px+
- Large Desktop: 1920px+

**Touch Optimization:**
- Minimum tap target: 44x44px
- Swipe gestures for navigation
- Touch-friendly forms and inputs
- Optimized scrolling performance

---

## 5. PHASE 1 COMPLETION TASKS

### 5.1 Settings Page Implementation (Priority: CRITICAL)

**Tab 1: System Configuration**
- Library name and hours
- Session time limits by grade level
- Default checkout periods
- Fine calculation rules
- Equipment management settings

**Tab 2: User Management**
- User list with role assignment
- Add/edit/delete users
- Permission matrix editor
- Password reset functionality

**Tab 3: Google Sheets Integration**
- Credentials upload interface
- Spreadsheet ID configuration
- Sync schedule settings
- Field mapping configuration
- Manual sync trigger

**Tab 4: Automation Settings**
- Job schedule management
- Email notification templates
- SMS alert configuration (optional)
- Backup schedule settings
- Maintenance window configuration

**Tab 5: Backup & Restore**
- Manual backup trigger
- Backup history display
- Restore interface with warnings
- Backup destination configuration
- Automatic backup schedule

**Tab 6: System Logs**
- Real-time log viewer
- Log level filtering
- Search and export functionality
- Error tracking dashboard
- Audit trail browser

### 5.2 Mobile Responsive Optimization

**Component Updates:**
1. Dashboard tabs → Bottom navigation on mobile
2. Data tables → Horizontal scroll + compact view
3. Forms → Stack vertically on mobile
4. Modals → Full-screen on mobile
5. Charts → Touch-enabled with zoom

**Testing Requirements:**
- iOS Safari (iPad, iPhone)
- Android Chrome (various devices)
- Landscape and portrait orientations
- Touch gesture functionality
- Performance on low-end devices

### 5.3 Performance Optimization

**Backend Optimizations:**
1. **Database Query Optimization:**
   - Add indexes for frequent queries
   - Implement Prisma query optimization
   - Connection pooling tuning
   - Query result caching

2. **API Response Caching:**
   - Redis caching for analytics
   - ETags for conditional requests
   - Response compression (gzip)
   - Rate limiting implementation

3. **Background Jobs:**
   - Bull queue optimization
   - Job priority management
   - Failed job retry logic
   - Job monitoring dashboard

**Frontend Optimizations:**
1. **Bundle Size Reduction:**
   - Code splitting by route
   - Tree shaking optimization
   - Lazy loading components
   - Image optimization

2. **React Performance:**
   - Component memoization
   - Virtual scrolling for lists
   - Debounced search inputs
   - Optimistic UI updates

3. **Caching Strategies:**
   - TanStack Query cache configuration
   - Service worker caching
   - Asset versioning
   - CDN integration (future)

---

## 6. FEATURE SPECIFICATIONS

### 6.1 Student Management

**Core Features:**
- Complete CRUD operations
- Barcode/QR code generation
- Grade-based session limits
- Digital photo upload
- Activity history tracking
- Import from CSV/Excel

**Business Rules:**
- Primary (Preschool): 30 min sessions
- Grade School (1-6): 1 hour sessions
- Junior High (7-10): 1.5 hour sessions
- Senior High (11-12): 2 hour sessions
- Automatic session warnings at 80% time

### 6.2 Equipment Management

**Equipment Types:**
1. Student PC 1, 2, 3 (individual workstations)
2. AVR Room (group study, 6-10 capacity)
3. PlayStation 3 (recreational)
4. Chess Sets (board games)

**Features:**
- Real-time availability status
- Session assignment and tracking
- Usage analytics and reports
- Maintenance scheduling
- Equipment reservation system

### 6.3 USB Scanner Integration

**Supported Formats:**
- Code128 (student IDs)
- QR Codes (flexible encoding)
- ISBN (book integration)
- Equipment tags (asset tracking)

**Features:**
- Auto-activation on page load
- 30-minute duplicate scan prevention
- Visual and audio feedback
- Real-time WebSocket broadcasting
- Multi-device synchronization

### 6.4 Analytics & Reporting

**Dashboard Metrics:**
- Active sessions count
- Equipment utilization rates
- Peak usage hours
- Student engagement trends
- Popular resources

**Report Types:**
- Daily activity summary
- Monthly usage statistics
- Student behavior analytics
- Equipment performance reports
- Custom query builder

**Export Formats:**
- CSV (Excel compatible)
- PDF (printable reports)
- JSON (API integration)

---

## 7. TESTING REQUIREMENTS

### 7.1 Unit Testing
- Backend: 40+ tests with Vitest
- Frontend: 15+ tests with React Testing Library
- Target coverage: 80%+ for critical paths

### 7.2 Integration Testing
- API endpoint testing
- Database operation validation
- WebSocket communication testing
- Scanner integration testing

### 7.3 End-to-End Testing
- Complete user workflows
- Multi-device synchronization
- Authentication flows
- Error handling scenarios

### 7.4 Performance Testing
- Load testing (100 concurrent users)
- API response time benchmarks
- Bundle size monitoring
- Memory leak detection

### 7.5 Security Testing
- OWASP Top 10 vulnerability scan
- JWT token security validation
- SQL injection prevention testing
- XSS attack prevention testing

---

## 8. DEPLOYMENT ARCHITECTURE

### 8.1 Hardware Infrastructure

**Server PC (192.168.1.100):**
- Docker containers: MySQL, Redis, Backend, Frontend
- Minimum: 8GB RAM, 20GB storage
- Recommended: 16GB RAM, 50GB SSD

**Client Devices:**
- Librarian PC (192.168.1.101) - USB scanner
- Printing PC (192.168.1.102) - ID cards
- Student PCs (192.168.1.103-105) - Tracked equipment
- iPad - Mobile admin access

### 8.2 Network Configuration

**Firewall Rules:**
```
Port 3000 - Frontend (HTTP)
Port 3001 - Backend API (HTTP)
Port 3308 - MySQL (Internal)
Port 6380 - Redis (Internal)
```

**Access Control:**
- Local network only (192.168.1.0/24)
- VPN for remote admin (optional)
- No external internet required

### 8.3 Docker Services

**CRITICAL REQUIREMENT: Docker-First Development & Deployment**
The system MUST use Docker for both development and production to ensure:
- Environment parity (dev = prod)
- One-click startup for all team members and librarians
- Consistent dependency management
- Simplified deployment with zero manual setup

**Service Stack:**
1. MySQL 8.0 - Primary database with health checks
2. Redis 7 - Caching and queues with persistence
3. Backend API - Express application with hot-reload (dev) / optimized build (prod)
4. Frontend - Vite dev server (dev) / Nginx serving React (prod)
5. Scanner Service - USB hardware integration (planned)

**Development Mode (docker-compose.yml):**
- Volume mounting for hot-reload
- Source code changes reflect immediately
- Development-optimized images
- All services start with: `npm start` or `docker-compose up`

**Production Mode (docker-compose.prod.yml):**
- Multi-stage builds for optimized images
- No volume mounting (built artifacts only)
- Production environment variables
- Health checks with proper timeouts
- Automatic restart policies
- Start with: `npm run prod` or one-click .bat file

**Health Checks:**
- MySQL: `mysqladmin ping` (40s start period, 30s interval)
- Redis: `redis-cli ping` (30s interval)
- Backend: `curl -f http://localhost:3001/health` (120s start period)
- Frontend: HTTP 200 response (60s start period)

**Service Dependencies:**
- Backend depends on: mysql (healthy), redis (healthy)
- Frontend depends on: backend (healthy)
- All services: restart unless-stopped

---

## 9. DOCUMENTATION REQUIREMENTS

### 9.1 Technical Documentation
- API endpoint documentation (OpenAPI/Swagger)
- Database schema documentation
- Architecture decision records (ADRs)
- Deployment procedures
- Troubleshooting guides

### 9.2 User Documentation
- Librarian quick start guide
- Student check-in procedures
- Equipment booking guide
- Report generation tutorials
- Settings configuration manual

### 9.3 Development Documentation
- Setup instructions (README)
- Contributing guidelines
- Code style guide
- Testing procedures
- Release process

---

## 10. SUCCESS CRITERIA

### 10.1 Phase 1 Completion Metrics
1. ✅ Settings page fully functional (6 tabs)
2. ✅ Mobile responsive on all devices
3. ✅ Performance targets met:
   - API response < 200ms (p95)
   - Initial load < 3 seconds
   - Bundle size < 2.5MB compressed
4. ✅ Test coverage > 80%
5. ✅ Zero critical security vulnerabilities

### 10.2 Production Readiness Checklist
- [ ] All 26 API endpoints tested
- [ ] All 13 frontend tabs functional
- [ ] Docker deployment tested
- [ ] Multi-device sync validated
- [ ] USB scanner integration verified
- [ ] Backup/restore procedures tested
- [ ] Documentation complete
- [ ] User training materials ready

### 10.3 User Experience Goals
- < 5 min onboarding for new librarians
- < 10 sec student check-in/check-out
- Zero data loss during system updates
- 99.9% uptime during library hours
- < 1 min to generate any report

---

## 11. FUTURE ENHANCEMENTS (Phase 2+)

### 11.1 Advanced Features
- Machine learning for usage forecasting
- Mobile app for students (self-service)
- Integration with school LMS
- Multi-library support
- Advanced analytics with AI insights

### 11.2 Integration Opportunities
- Koha catalog deep integration
- Google Workspace SSO
- Email notification system
- SMS alert system
- Cloud backup integration

### 11.3 Scalability Improvements
- Database clustering
- Load balancing
- Cloud deployment options
- API rate limiting
- Distributed caching

---

## 12. RISK MITIGATION

### 12.1 Technical Risks
- **Database Corruption:** Automated daily backups
- **Network Failure:** Offline mode for essential operations
- **Scanner Malfunction:** Fallback manual entry
- **System Downtime:** Hot-swap deployment strategy

### 12.2 Security Risks
- **Data Breach:** Encryption + access controls
- **Unauthorized Access:** MFA for admins
- **Token Theft:** Short-lived tokens + rotation
- **SQL Injection:** Parameterized queries only

### 12.3 Operational Risks
- **User Training:** Comprehensive training program
- **System Adoption:** Phased rollout with support
- **Data Migration:** Extensive testing before cutover
- **Performance Issues:** Monitoring and alerting

---

## 13. PROJECT TIMELINE

### Phase 1: Core Completion (Weeks 1-4)
- Week 1: Settings page implementation
- Week 2: Mobile responsive optimization
- Week 3: Performance enhancements
- Week 4: Testing and documentation

### Phase 2: Production Deployment (Week 5)
- Hardware setup and network configuration
- Docker deployment and testing
- User training and onboarding
- Go-live and monitoring

### Phase 3: Stabilization (Weeks 6-8)
- Bug fixes and optimization
- User feedback incorporation
- Performance tuning
- Documentation updates

---

## 14. RESEARCH-INFORMED RECOMMENDATIONS

### 14.1 Educational Technology Trends (from Research)
- **IoT Integration:** Consider RFID for equipment tracking
- **Cloud-Based Services:** Plan for future cloud migration
- **AI/ML Features:** Implement predictive analytics for resource allocation
- **Mobile-First Design:** Prioritize mobile experience
- **Data Analytics:** Advanced reporting with visualization

### 14.2 Library Management Best Practices (from Research)
- **Automation Focus:** Maximize automated workflows
- **User-Centric Design:** Prioritize ease of use
- **Scalability Planning:** Design for growth
- **Integration Readiness:** API-first architecture
- **Community Engagement:** Student self-service features

### 14.3 Security Standards (from Research)
- **Zero Trust Architecture:** Verify all access attempts
- **Least Privilege Principle:** Minimal permissions by default
- **Defense in Depth:** Multiple security layers
- **Regular Audits:** Quarterly security reviews
- **Incident Response Plan:** Documented procedures

---

## 15. TECHNICAL DEBT & MAINTENANCE

### 15.1 Known Technical Debt
- Implement comprehensive error boundaries
- Add TypeScript strict mode enforcement
- Refactor monolithic service files
- Implement comprehensive logging
- Add performance monitoring

### 15.2 Maintenance Schedule
- **Daily:** Automated backups, log rotation
- **Weekly:** Security vulnerability scans
- **Monthly:** Performance reviews, dependency updates
- **Quarterly:** Security audits, disaster recovery drills
- **Annually:** Architecture review, technology updates

---

## APPENDIX: REFERENCE MATERIALS

### Research Sources
1. FERPA Compliance Checklist (Bright Defense, 2025)
2. JWT Security Best Practices (JWTSecrets.com, 2025)
3. PWA Offline-First Architecture (Medium, 2025)
4. Educational Technology Trends (IEEE, 2025)
5. React 18 Performance Optimization (facebook/react v18.3.1)
6. Prisma ORM Best Practices (prisma/docs)
7. Docker Production Deployment (docker/docs)

### Key Technologies Documentation
- React 18: https://react.dev
- Prisma: https://www.prisma.io/docs
- Docker: https://docs.docker.com
- Express: https://expressjs.com
- TailwindCSS: https://tailwindcss.com

---

**Document Status:** Complete and Research-Validated
**Last Updated:** January 2025
**Next Review:** Phase 1 Completion
